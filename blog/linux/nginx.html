<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>docker 安装nginx | Eru blog</title>
    <meta name="description" content="blog">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.497d64f8.css" as="style"><link rel="preload" href="/assets/js/app.b4c42823.js" as="script"><link rel="preload" href="/assets/js/2.dee33d11.js" as="script"><link rel="preload" href="/assets/js/19.0ce8bab8.js" as="script"><link rel="prefetch" href="/assets/js/10.a748f063.js"><link rel="prefetch" href="/assets/js/11.3dd9799e.js"><link rel="prefetch" href="/assets/js/12.87c1c0af.js"><link rel="prefetch" href="/assets/js/13.9d44b990.js"><link rel="prefetch" href="/assets/js/14.73b0b64a.js"><link rel="prefetch" href="/assets/js/15.1e1621cb.js"><link rel="prefetch" href="/assets/js/16.a98f8b5d.js"><link rel="prefetch" href="/assets/js/17.1efdd945.js"><link rel="prefetch" href="/assets/js/18.b0095805.js"><link rel="prefetch" href="/assets/js/20.725791ed.js"><link rel="prefetch" href="/assets/js/21.4e80a438.js"><link rel="prefetch" href="/assets/js/22.93c6dabb.js"><link rel="prefetch" href="/assets/js/23.fd0f3d05.js"><link rel="prefetch" href="/assets/js/3.1069691d.js"><link rel="prefetch" href="/assets/js/4.bcc49361.js"><link rel="prefetch" href="/assets/js/5.8e5ea0c4.js"><link rel="prefetch" href="/assets/js/6.3ba5287a.js"><link rel="prefetch" href="/assets/js/7.1c60ee1c.js"><link rel="prefetch" href="/assets/js/8.4b0533a8.js"><link rel="prefetch" href="/assets/js/9.cbf2f7df.js">
    <link rel="stylesheet" href="/assets/css/0.styles.497d64f8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Eru blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术笔记" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/typescript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link router-link-active">Linux</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div><div class="nav-item"><a href="https://github.com/moonljr/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术笔记" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/typescript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link router-link-active">Linux</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div><div class="nav-item"><a href="https://github.com/moonljr/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Linux</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/linux/" class="sidebar-link">Linux</a></li><li><a href="/linux/docker.html" class="sidebar-link">docker</a></li><li><a href="/linux/nginx.html" class="active sidebar-link">docker 安装nginx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/linux/nginx.html#docker-安装nginx" class="sidebar-link">docker 安装nginx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/linux/nginx.html#nginx-配置https" class="sidebar-link">nginx 配置https</a></li><li class="sidebar-sub-header"><a href="/linux/nginx.html#在hub上搜索nginx" class="sidebar-link">在hub上搜索nginx</a></li><li class="sidebar-sub-header"><a href="/linux/nginx.html#拉去nginx镜像" class="sidebar-link">拉去nginx镜像</a></li><li class="sidebar-sub-header"><a href="/linux/nginx.html#查看镜像" class="sidebar-link">查看镜像</a></li><li class="sidebar-sub-header"><a href="/linux/nginx.html#配置挂载文件并且运行nginx" class="sidebar-link">配置挂载文件并且运行nginx</a></li><li class="sidebar-sub-header"><a href="/linux/nginx.html#补充" class="sidebar-link">补充</a></li></ul></li></ul></li><li><a href="/linux/git.html" class="sidebar-link">linux 安装git</a></li><li><a href="/linux/mysql.html" class="sidebar-link">docker 安装 mysql</a></li><li><a href="/linux/node.html" class="sidebar-link">linux 安装 node</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="docker-安装nginx"><a href="#docker-安装nginx" class="header-anchor">#</a> docker 安装nginx</h2> <ol><li>在docker hub上搜索nginx</li> <li>拉去官方镜像</li> <li>查看镜像</li> <li>配置挂载文件并且运行nginx</li> <li>停止容器 <code>docker stop 容器name or id</code></li> <li>启动或重启容器 <code>docker start name or id docker restart name or id</code></li> <li>删除容器 <code>删除容器之前需要先停止容器 docker rm name or id</code></li> <li>查看容器运行状态 <code>docker ps -a</code></li></ol> <h3 id="nginx-配置https"><a href="#nginx-配置https" class="header-anchor">#</a> nginx 配置https</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>server <span class="token punctuation">{</span>
	listen <span class="token number">443</span><span class="token punctuation">;</span>
	server_name erull.cn<span class="token punctuation">;</span>
	ssl on<span class="token punctuation">;</span>
	ssl_certificate   /etc/nginx/cert/erull.pem<span class="token punctuation">;</span>
	ssl_certificate_key  /etc/nginx/cert/erull.key<span class="token punctuation">;</span>
	ssl_session_timeout 5m<span class="token punctuation">;</span>
	ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:<span class="token operator">!</span>NULL:<span class="token operator">!</span>aNULL:<span class="token operator">!</span>MD5:<span class="token operator">!</span>ADH:<span class="token operator">!</span>RC4<span class="token punctuation">;</span>
	ssl_protocols TLSv1 TLSv1.1 TLSv1.2<span class="token punctuation">;</span>
	ssl_prefer_server_ciphers on<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span>
        root   /usr/share/nginx/html/<span class="token punctuation">;</span>
        index  index.html<span class="token punctuation">;</span>
        <span class="token comment"># autoindex  on;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 server<span class="token punctuation">{</span>
	listen <span class="token number">80</span><span class="token punctuation">;</span>
	server_name erull.cn<span class="token punctuation">;</span>
	rewrite ^/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$ https://erull.cn:443/<span class="token variable">$1</span> permanent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="在hub上搜索nginx"><a href="#在hub上搜索nginx" class="header-anchor">#</a> 在hub上搜索nginx</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>docker search nginx
</code></pre></div><h3 id="拉去nginx镜像"><a href="#拉去nginx镜像" class="header-anchor">#</a> 拉去nginx镜像</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>docker pull nginx <span class="token comment"># 一般拉取stars最多的镜像</span>
</code></pre></div><h3 id="查看镜像"><a href="#查看镜像" class="header-anchor">#</a> 查看镜像</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>docker images
</code></pre></div><h3 id="配置挂载文件并且运行nginx"><a href="#配置挂载文件并且运行nginx" class="header-anchor">#</a> 配置挂载文件并且运行nginx</h3> <ul><li><p>首先在宿主机上创建nginx目录用来存放后面相关的配置文件</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> -p ~/nginx/www ~/nginx/logs ~/nginx/conf ~/nginx/conf.d
<span class="token comment"># ~/nginx/www 相当于nginx的html目录用来存放静态文件的</span>
<span class="token comment"># ~/nginx/logs nginx的日志文件</span>
<span class="token comment">#  ~/nginx/conf ~/nginx/conf.d nginx的配置文件</span>
</code></pre></div></li> <li><p>记得要拷贝一份nginx.conf 到 conf目录，拷贝一份default.conf 到 conf.d目录下</p> <ul><li>nginx.conf 文件是Nginx的总配置文件</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># nginx.conf</span>
user  nginx<span class="token punctuation">;</span> <span class="token comment"># 运行用户，默认是nginx，可以不进行设置</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">#Nginx进程，一般设置和cpu核数一样</span>

error_log  /var/log/nginx/error.log warn<span class="token punctuation">;</span> <span class="token comment">#错误日志存放位置</span>
pid        /var/run/nginx.pid<span class="token punctuation">;</span> <span class="token comment">#进程pid存放位置</span>


events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token comment">#单个后台进程的最大并发数</span>
<span class="token punctuation">}</span>


http <span class="token punctuation">{</span>
    include       /etc/nginx/mime.types<span class="token punctuation">;</span> <span class="token comment">#文件扩展名和类型映射表</span>
    default_type  application/octet-stream<span class="token punctuation">;</span> <span class="token comment">#默认的文件类型</span>
		<span class="token comment">#设置日志模式</span>
    log_format  main  <span class="token string">'<span class="token variable">$remote_addr</span> - <span class="token variable">$remote_user</span> [<span class="token variable">$time_local</span>] &quot;<span class="token variable">$request</span>&quot; '</span>
                      <span class="token string">'<span class="token variable">$status</span> <span class="token variable">$body_bytes_sent</span> &quot;<span class="token variable">$http_referer</span>&quot; '</span>
                      <span class="token string">'&quot;<span class="token variable">$http_user_agent</span>&quot; &quot;<span class="token variable">$http_x_forwarded_for</span>&quot;'</span><span class="token punctuation">;</span>

    access_log  /var/log/nginx/access.log  main<span class="token punctuation">;</span> <span class="token comment">#nginx访问日志的存放位置</span>

    sendfile        on<span class="token punctuation">;</span> <span class="token comment">#是否开启高效传输模式 on开启 off关闭</span>
    <span class="token comment">#tcp_nopush     on; #减少网络报文段的数量</span>

    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span> <span class="token comment">#保持连接的时间，也叫超时时间</span>

    <span class="token comment">#gzip  on; #开启gzip压缩模式</span>

    include /etc/nginx/conf.d/*.conf<span class="token punctuation">;</span> <span class="token comment">#包含的子配置项的位置和文件</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>default.conf</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>  <span class="token comment">#配置监听端口</span>
    server_name  localhost<span class="token punctuation">;</span>  <span class="token comment"># 配置域名</span>

    <span class="token comment">#charset koi8-r;</span>
    <span class="token comment">#access_log  /var/log/nginx/log/host.access.log  main;</span>

    location / <span class="token punctuation">{</span>
        <span class="token comment">#  root   /data/nginx/html;</span>
        root   /usr/share/nginx/html<span class="token punctuation">;</span> <span class="token comment">#服务默认启动目录</span>
        index  index.html index.htm<span class="token punctuation">;</span>  <span class="token comment">#默认访问文件</span>
        autoindex  on<span class="token punctuation">;</span>
        <span class="token comment"># deny   123.1.41.23; # 禁止访问的ip 还可以设置ip段 123.1.1.12/100  12-100</span>
        <span class="token comment"># allow  123.14.1.4;  # 允许访问的ip</span>
	    <span class="token comment"># try_files $uri /index/index/page.html;</span>
        <span class="token comment">#try_files $uri /index/map/page.html;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">#location =/img {  # 配置页面的访问权限  `=` 精确匹配符号</span>
    <span class="token comment">#   allow all;  # 允许所有的ip访问</span>
    <span class="token comment">#}</span>
    <span class="token comment">#location =/admin {</span>
    <span class="token comment">#    deny all; # 禁止所有的ip访问</span>
    <span class="token comment">#}</span>
    <span class="token comment">#location ~\.php$ { # 禁止以php结尾的文件访问</span>
    <span class="token comment">#   deny all;</span>
    <span class="token comment">#}</span>

    <span class="token comment">#error_page  404              /404.html;   # 配置404页面</span>

    <span class="token comment"># redirect server error pages to the static page /50x.html</span>
    <span class="token comment">#</span>
    error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>  <span class="token comment">#错误状态码的显示页面，配置后需要重启</span>
    location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
        root   /usr/share/nginx/html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span>
    <span class="token comment">#</span>
    <span class="token comment">#location ~ \.php$ {</span>
    <span class="token comment">#    proxy_pass   http://127.0.0.1;</span>
    <span class="token comment">#}</span>

    <span class="token comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span>
    <span class="token comment">#</span>
    <span class="token comment">#location ~ \.php$ {</span>
    <span class="token comment">#    root           html;</span>
    <span class="token comment">#    fastcgi_pass   127.0.0.1:9000;</span>
    <span class="token comment">#    fastcgi_index  index.php;</span>
    <span class="token comment">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span>
    <span class="token comment">#    include        fastcgi_params;</span>
    <span class="token comment">#}</span>

    <span class="token comment"># deny access to .htaccess files, if Apache's document root</span>
    <span class="token comment"># concurs with nginx's one</span>
    <span class="token comment">#</span>
    <span class="token comment">#location ~ /\.ht {</span>
    <span class="token comment">#    deny  all;</span>
    <span class="token comment">#}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>运行nginx</p></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code> docker run -d -p <span class="token number">80</span>:80 --restart<span class="token operator">=</span>always --name nginx80 -v ~/nginx/www:/usr/share/nginx/html -v ~/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v ~/nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf -v ~/nginx/logs:/var/log/nginx nginx

 <span class="token comment"># 命令说明</span>
 <span class="token comment"># -d 后台运行nginx</span>
 <span class="token comment"># -p 80:80： 将容器的 80 端口映射到主机的 80端口</span>
 <span class="token comment"># --restart=always 当docker重启的时候会自动启动容器</span>
 <span class="token comment"># --name nginx80：将容器命名为 nginx80。（别名的意思）</span>
 <span class="token comment"># -v ~/nginx/www:/usr/share/nginx/html：将我们自己创建的 www 目录挂载到容器的 /usr/share/nginx/html。</span>
 <span class="token comment"># -v ~/nginx/conf/nginx.conf:/etc/nginx/nginx.conf：将我们自己创建的 nginx.conf 挂载到容器的 /etc/nginx/nginx.conf。</span>
 <span class="token comment"># -v ~/nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf 将我们自己创建的 default.conf 挂载到容器的 /etc/nginx/conf.d/default.conf。</span>
 <span class="token comment"># -v ~/nginx/logs:/var/log/nginx：将我们自己创建的 logs 挂载到容器的 /var/log/nginx。</span>
</code></pre></div><h3 id="补充"><a href="#补充" class="header-anchor">#</a> 补充</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>docker run -d -p <span class="token number">80</span>:80 --name nginx80 -v ~/nginx/www:/usr/share/nginx -v ~/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v ~/nginx/conf.d:/etc/nginx/conf.d -v ~/nginx/logs:/var/log/nginx nginx

<span class="token comment"># -v ~/nginx/conf.d:/etc/nginx/conf.d 本来是将default.conf映射到容器里边的 但是后来配置二级路由的时候发现使用多个 *.conf的配置文件的方式去配置路由不生效 查了下原因才发现启动容器的时候只映射了default.conf 没有映射其他的配置文件</span>

<span class="token comment"># -v ~/nginx/www:/usr/share/nginx 映射到和html同级的目录 用不同的目录区分不同二级域名下的文件</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/linux/docker.html" class="prev">docker</a></span> <span class="next"><a href="/linux/git.html">linux 安装git</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b4c42823.js" defer></script><script src="/assets/js/2.dee33d11.js" defer></script><script src="/assets/js/19.0ce8bab8.js" defer></script>
  </body>
</html>
