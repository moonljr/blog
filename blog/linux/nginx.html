<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>docker 安装nginx | Eru blog</title>
    <meta name="description" content="blog">
    <link rel="icon" href="/blog/favicon.ico">
    
    <link rel="preload" href="/blog/assets/css/0.styles.56e7b396.css" as="style"><link rel="preload" href="/blog/assets/js/app.930aeafb.js" as="script"><link rel="preload" href="/blog/assets/js/2.a4e5ced4.js" as="script"><link rel="preload" href="/blog/assets/js/19.07178428.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.aa761517.js"><link rel="prefetch" href="/blog/assets/js/11.9a8a56f7.js"><link rel="prefetch" href="/blog/assets/js/12.64879133.js"><link rel="prefetch" href="/blog/assets/js/13.ea183de5.js"><link rel="prefetch" href="/blog/assets/js/14.407aee0b.js"><link rel="prefetch" href="/blog/assets/js/15.2f143cb7.js"><link rel="prefetch" href="/blog/assets/js/16.88f82a7a.js"><link rel="prefetch" href="/blog/assets/js/17.ee648c06.js"><link rel="prefetch" href="/blog/assets/js/18.c7cd4e2b.js"><link rel="prefetch" href="/blog/assets/js/20.506ec991.js"><link rel="prefetch" href="/blog/assets/js/21.901306cb.js"><link rel="prefetch" href="/blog/assets/js/22.b84c4581.js"><link rel="prefetch" href="/blog/assets/js/23.39a93be0.js"><link rel="prefetch" href="/blog/assets/js/3.d781a63e.js"><link rel="prefetch" href="/blog/assets/js/4.872ab005.js"><link rel="prefetch" href="/blog/assets/js/5.7aad788c.js"><link rel="prefetch" href="/blog/assets/js/6.da0a4ee3.js"><link rel="prefetch" href="/blog/assets/js/7.620452b7.js"><link rel="prefetch" href="/blog/assets/js/8.edc30130.js"><link rel="prefetch" href="/blog/assets/js/9.75eea114.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.56e7b396.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Eru blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/blog/typescript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/blog/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/blog/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/blog/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/blog/node/" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/blog/linux/" class="nav-link router-link-active">Linux</a></li></ul></div></div><div class="nav-item"><a href="/blog/about/" class="nav-link">关于我</a></div><div class="nav-item"><a href="https://github.com/moonljr/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/blog/typescript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/blog/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/blog/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/blog/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/blog/node/" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/blog/linux/" class="nav-link router-link-active">Linux</a></li></ul></div></div><div class="nav-item"><a href="/blog/about/" class="nav-link">关于我</a></div><div class="nav-item"><a href="https://github.com/moonljr/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Linux</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/linux/" class="sidebar-link">Linux</a></li><li><a href="/blog/linux/docker.html" class="sidebar-link">docker</a></li><li><a href="/blog/linux/nginx.html" class="active sidebar-link">docker 安装nginx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/linux/nginx.html#docker-安装nginx" class="sidebar-link">docker 安装nginx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/linux/nginx.html#nginx-配置https" class="sidebar-link">nginx 配置https</a></li><li class="sidebar-sub-header"><a href="/blog/linux/nginx.html#在hub上搜索nginx" class="sidebar-link">在hub上搜索nginx</a></li><li class="sidebar-sub-header"><a href="/blog/linux/nginx.html#拉去nginx镜像" class="sidebar-link">拉去nginx镜像</a></li><li class="sidebar-sub-header"><a href="/blog/linux/nginx.html#查看镜像" class="sidebar-link">查看镜像</a></li><li class="sidebar-sub-header"><a href="/blog/linux/nginx.html#配置挂载文件并且运行nginx" class="sidebar-link">配置挂载文件并且运行nginx</a></li><li class="sidebar-sub-header"><a href="/blog/linux/nginx.html#补充" class="sidebar-link">补充</a></li></ul></li></ul></li><li><a href="/blog/linux/git.html" class="sidebar-link">linux 安装git</a></li><li><a href="/blog/linux/mysql.html" class="sidebar-link">docker 安装 mysql</a></li><li><a href="/blog/linux/node.html" class="sidebar-link">linux 安装 node</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="docker-安装nginx"><a href="#docker-安装nginx" aria-hidden="true" class="header-anchor">#</a> docker 安装nginx</h2> <ol><li>在docker hub上搜索nginx</li> <li>拉去官方镜像</li> <li>查看镜像</li> <li>配置挂载文件并且运行nginx</li> <li>停止容器 <code>docker stop 容器name or id</code></li> <li>启动或重启容器 <code>docker start name or id docker restart name or id</code></li> <li>删除容器 <code>删除容器之前需要先停止容器 docker rm name or id</code></li> <li>查看容器运行状态 <code>docker ps -a</code></li></ol> <h3 id="nginx-配置https"><a href="#nginx-配置https" aria-hidden="true" class="header-anchor">#</a> nginx 配置https</h3> <div class="language-shell extra-class"><pre class="language-text"><code>server {
	listen 443;
	server_name erull.cn;
	ssl on;
	ssl_certificate   /etc/nginx/cert/erull.pem;
	ssl_certificate_key  /etc/nginx/cert/erull.key;
	ssl_session_timeout 5m;
	ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
	ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
	ssl_prefer_server_ciphers on;

    location / {
        root   /usr/share/nginx/html/;
        index  index.html;
        # autoindex  on;
    }
}
 server{
	listen 80;
	server_name erull.cn;
	rewrite ^/(.*)$ https://erull.cn:443/$1 permanent;
}
</code></pre></div><h3 id="在hub上搜索nginx"><a href="#在hub上搜索nginx" aria-hidden="true" class="header-anchor">#</a> 在hub上搜索nginx</h3> <div class="language-shell extra-class"><pre class="language-text"><code>docker search nginx
</code></pre></div><h3 id="拉去nginx镜像"><a href="#拉去nginx镜像" aria-hidden="true" class="header-anchor">#</a> 拉去nginx镜像</h3> <div class="language-shell extra-class"><pre class="language-text"><code>docker pull nginx # 一般拉取stars最多的镜像
</code></pre></div><h3 id="查看镜像"><a href="#查看镜像" aria-hidden="true" class="header-anchor">#</a> 查看镜像</h3> <div class="language-shell extra-class"><pre class="language-text"><code>docker images
</code></pre></div><h3 id="配置挂载文件并且运行nginx"><a href="#配置挂载文件并且运行nginx" aria-hidden="true" class="header-anchor">#</a> 配置挂载文件并且运行nginx</h3> <ul><li><p>首先在宿主机上创建nginx目录用来存放后面相关的配置文件</p> <div class="language-shell extra-class"><pre class="language-text"><code>mkdir -p ~/nginx/www ~/nginx/logs ~/nginx/conf ~/nginx/conf.d
# ~/nginx/www 相当于nginx的html目录用来存放静态文件的
# ~/nginx/logs nginx的日志文件
#  ~/nginx/conf ~/nginx/conf.d nginx的配置文件
</code></pre></div></li> <li><p>记得要拷贝一份nginx.conf 到 conf目录，拷贝一份default.conf 到 conf.d目录下</p> <ul><li>nginx.conf 文件是Nginx的总配置文件</li></ul> <div class="language-shell extra-class"><pre class="language-text"><code># nginx.conf
user  nginx; # 运行用户，默认是nginx，可以不进行设置
worker_processes  1; #Nginx进程，一般设置和cpu核数一样

error_log  /var/log/nginx/error.log warn; #错误日志存放位置
pid        /var/run/nginx.pid; #进程pid存放位置


events {
    worker_connections  1024; #单个后台进程的最大并发数
}


http {
    include       /etc/nginx/mime.types; #文件扩展名和类型映射表
    default_type  application/octet-stream; #默认的文件类型
		#设置日志模式
    log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
                      '$status $body_bytes_sent &quot;$http_referer&quot; '
                      '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';

    access_log  /var/log/nginx/access.log  main; #nginx访问日志的存放位置

    sendfile        on; #是否开启高效传输模式 on开启 off关闭
    #tcp_nopush     on; #减少网络报文段的数量

    keepalive_timeout  65; #保持连接的时间，也叫超时时间

    #gzip  on; #开启gzip压缩模式

    include /etc/nginx/conf.d/*.conf; #包含的子配置项的位置和文件
}
</code></pre></div><ul><li>default.conf</li></ul> <div class="language-shell extra-class"><pre class="language-text"><code>server {
    listen       80;  #配置监听端口
    server_name  localhost;  # 配置域名

    #charset koi8-r;
    #access_log  /var/log/nginx/log/host.access.log  main;

    location / {
        #  root   /data/nginx/html;
        root   /usr/share/nginx/html; #服务默认启动目录
        index  index.html index.htm;  #默认访问文件
        autoindex  on;
        # deny   123.1.41.23; # 禁止访问的ip 还可以设置ip段 123.1.1.12/100  12-100
        # allow  123.14.1.4;  # 允许访问的ip
	    # try_files $uri /index/index/page.html;
        #try_files $uri /index/map/page.html;
    }
    #location =/img {  # 配置页面的访问权限  `=` 精确匹配符号
    #   allow all;  # 允许所有的ip访问
    #}
    #location =/admin {
    #    deny all; # 禁止所有的ip访问
    #}
    #location ~\.php$ { # 禁止以php结尾的文件访问
    #   deny all;
    #}

    #error_page  404              /404.html;   # 配置404页面

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;  #错误状态码的显示页面，配置后需要重启
    location = /50x.html {
        root   /usr/share/nginx/html;
    }

    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #
    #location ~ \.php$ {
    #    proxy_pass   http://127.0.0.1;
    #}

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    #location ~ \.php$ {
    #    root           html;
    #    fastcgi_pass   127.0.0.1:9000;
    #    fastcgi_index  index.php;
    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
    #    include        fastcgi_params;
    #}

    # deny access to .htaccess files, if Apache's document root
    # concurs with nginx's one
    #
    #location ~ /\.ht {
    #    deny  all;
    #}
}
</code></pre></div></li> <li><p>运行nginx</p></li></ul> <div class="language-shell extra-class"><pre class="language-text"><code> docker run -d -p 80:80 --restart=always --name nginx80 -v ~/nginx/www:/usr/share/nginx/html -v ~/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v ~/nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf -v ~/nginx/logs:/var/log/nginx nginx

 # 命令说明
 # -d 后台运行nginx
 # -p 80:80： 将容器的 80 端口映射到主机的 80端口
 # --restart=always 当docker重启的时候会自动启动容器
 # --name nginx80：将容器命名为 nginx80。（别名的意思）
 # -v ~/nginx/www:/usr/share/nginx/html：将我们自己创建的 www 目录挂载到容器的 /usr/share/nginx/html。
 # -v ~/nginx/conf/nginx.conf:/etc/nginx/nginx.conf：将我们自己创建的 nginx.conf 挂载到容器的 /etc/nginx/nginx.conf。
 # -v ~/nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf 将我们自己创建的 default.conf 挂载到容器的 /etc/nginx/conf.d/default.conf。
 # -v ~/nginx/logs:/var/log/nginx：将我们自己创建的 logs 挂载到容器的 /var/log/nginx。
</code></pre></div><h3 id="补充"><a href="#补充" aria-hidden="true" class="header-anchor">#</a> 补充</h3> <div class="language-shell extra-class"><pre class="language-text"><code>docker run -d -p 80:80 --name nginx80 -v ~/nginx/www:/usr/share/nginx -v ~/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v ~/nginx/conf.d:/etc/nginx/conf.d -v ~/nginx/logs:/var/log/nginx nginx

# -v ~/nginx/conf.d:/etc/nginx/conf.d 本来是将default.conf映射到容器里边的 但是后来配置二级路由的时候发现使用多个 *.conf的配置文件的方式去配置路由不生效 查了下原因才发现启动容器的时候只映射了default.conf 没有映射其他的配置文件

# -v ~/nginx/www:/usr/share/nginx 映射到和html同级的目录 用不同的目录区分不同二级域名下的文件
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/linux/docker.html" class="prev">
          docker
        </a></span> <span class="next"><a href="/blog/linux/git.html">
          linux 安装git
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.930aeafb.js" defer></script><script src="/blog/assets/js/2.a4e5ced4.js" defer></script><script src="/blog/assets/js/19.07178428.js" defer></script>
  </body>
</html>
